### 跳表

#### 1.什么是跳表

对于一个单链表来讲，即便链表中存储的数据是有序的，如果我们要想在其中查找某个数据，也只能从头到尾遍历链表。这样查找效率就会很低，时间复杂度会很高，是 O(n)。

为了提高查找效率，提出了跳表。

如下图，对链表建立索引，可以加快查找效率

![img](https://gitee.com/sunnyzq/my-image-hosting-service/raw/master/img//492206afe5e2fef9f683c7cff83afa65.jpg)

![img](https://gitee.com/sunnyzq/my-image-hosting-service/raw/master/img//46d283cd82c987153b3fe0c76dfba8a9.jpg)

#### 2.跳表的复杂度分析

##### 时间复杂度

**查询任意数据的时间复杂度是O(logn)** ,和二分查找的时间复杂度相同

跳表这个动态数据结构，不仅支持查找操作，还支持动态的插入、删除操作，而且**插入、删除操作的时间复杂度也是 O(logn)。**

注意：跳表是一种动态的数据结构，插入和删除数据时要及时更新索引，避免极端情况退化成单链表

##### 空间复杂度

跳表是一种空间换时间的设计思路

比起单纯的单链表，跳表需要存储多级索引，肯定要消耗更多的存储空间。

假设原始链表大小为 n，那第一级索引大约有 n/2 个结点，第二级索引大约有 n/4 个结点，以此类推，每上升一级就减少一半，直到剩下 2 个结点。如果我们把每层索引的结点数写出来，就是一个等比数列。

![img](https://gitee.com/sunnyzq/my-image-hosting-service/raw/master/img//100e9d6e5abeaae542cf7841be3f8255.jpg)

这几级索引的结点总和就是 n/2+n/4+n/8…+8+4+2=n-2。

所以，**跳表的空间复杂度是 O(n)**。

在实际的软件开发中，原始链表中存储的有可能是很大的对象，而索引结点只需要存储关键值和几个指针，并不需要存储对象，所以当对象比索引结点大很多时，那索引占用的额外空间就可以忽略了

#### 3.随机函数

当我们往跳表中插入数据的时候，我们可以选择同时将这个数据插入到部分索引层中。如何选择加入哪些索引层呢？

通过一个随机函数，来决定将这个结点插入到哪几级索引中，比如随机函数生成了值 K，那我们就将这个结点添加到第一级到第 K 级这 K 级索引中。

随机函数的选择很有讲究，从概率上来讲，能够保证跳表的索引大小和数据大小平衡性，不至于性能过度退化。

#### 4.Redis跳表的应用

Redis 中的有序集合是通过跳表来实现的（严格点讲，其实还用到了散列表）。

Redis 中的有序集合支持的核心操作主要有下面这几个：

- 插入一个数据；
- 删除一个数据；
- 查找一个数据；
- 按照区间查找数据（比如查找值在[100, 356]之间的数据）；
- 迭代输出有序序列。

其中，插入、删除、查找以及迭代输出有序序列这几个操作，红黑树也可以完成，时间复杂度跟跳表是一样的。但是，**按照区间来查找数据这个操作，红黑树的效率没有跳表高。**

Redis用跳表实现数据的有序集合，而不同红黑树，还有一个原因就是跳表相对于红黑树代码好懂，容易，可读性好。

但是，红黑树在许多编程语言中有现成的，比如java中的Map是用红黑树实现的，可以直接用；跳表没有现成的，需要自己实现。

参考代码：https://github.com/wangzheng0822/algo/tree/master/java/17_skiplist

